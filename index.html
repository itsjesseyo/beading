<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixelated Beading Pattern</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 800px;
            width: 100%;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        
        .canvas-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .canvas-section {
            text-align: center;
        }
        
        .canvas-section h3 {
            margin-bottom: 10px;
            color: #555;
        }
        
        canvas {
            border: 2px solid #333;
            border-radius: 5px;
            background: white;
        }
        
        .controls {
            text-align: center;
            margin-top: 20px;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 10px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .info {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: #e9ecef;
            border-radius: 5px;
            color: #666;
        }
        
        #fileInput {
            display: none;
        }
        
        .upload-label {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            display: inline-block;
            margin: 10px;
        }
        
        .upload-label:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Pixelated Beading Pattern Generator</h1>
        
        <div class="controls">
            <label for="fileInput" class="upload-label">Upload Your Image</label>
            <input type="file" id="fileInput" accept="image/*">
            <button onclick="downloadPattern()">Download Pattern</button>
        </div>
        
        <div class="canvas-container">
            <div class="canvas-section">
                <h3>Original (Cropped to Circle)</h3>
                <canvas id="originalCanvas" width="300" height="300"></canvas>
            </div>
            
            <div class="canvas-section">
                <h3>60x60 Pixelated with Grid</h3>
                <canvas id="pixelatedCanvas" width="600" height="600"></canvas>
            </div>
        </div>
        
        <div class="info">
            <p><strong>Instructions:</strong> Upload your circular image to create a 60x60 pixelated beading pattern. The grid overlay will help you count beads for your project!</p>
            <p>Each square represents one bead. The pattern is optimized for circular beading projects.</p>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const originalCanvas = document.getElementById('originalCanvas');
        const pixelatedCanvas = document.getElementById('pixelatedCanvas');
        const originalCtx = originalCanvas.getContext('2d');
        const pixelatedCtx = pixelatedCanvas.getContext('2d');
        
        let currentImageData = null;

        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        processImage(img);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        function processImage(img) {
            // Clear canvases
            originalCtx.clearRect(0, 0, originalCanvas.width, originalCanvas.height);
            pixelatedCtx.clearRect(0, 0, pixelatedCanvas.width, pixelatedCanvas.height);
            
            // Draw original image cropped to circle
            drawCircularImage(originalCtx, img, 300, 300);
            
            // Create pixelated version
            createPixelatedPattern(img);
        }

        function drawCircularImage(ctx, img, width, height) {
            ctx.save();
            
            // Create circular clipping path
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = Math.min(width, height) / 2;
            
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.clip();
            
            // Calculate aspect ratio and draw image
            const imgAspect = img.width / img.height;
            const canvasAspect = width / height;
            
            let drawWidth, drawHeight, drawX, drawY;
            
            if (imgAspect > canvasAspect) {
                drawHeight = height;
                drawWidth = height * imgAspect;
                drawX = (width - drawWidth) / 2;
                drawY = 0;
            } else {
                drawWidth = width;
                drawHeight = width / imgAspect;
                drawX = 0;
                drawY = (height - drawHeight) / 2;
            }
            
            ctx.drawImage(img, drawX, drawY, drawWidth, drawHeight);
            ctx.restore();
        }

        function createPixelatedPattern(img) {
            // Create a temporary canvas for processing
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = 60;
            tempCanvas.height = 60;
            
            // Draw the image as a circle on the temp canvas
            drawCircularImage(tempCtx, img, 60, 60);
            
            // Get the image data
            const imageData = tempCtx.getImageData(0, 0, 60, 60);
            currentImageData = imageData;
            
            // Draw the pixelated version with grid
            const pixelSize = 10; // 600px / 60 = 10px per pixel
            
            for (let y = 0; y < 60; y++) {
                for (let x = 0; x < 60; x++) {
                    const index = (y * 60 + x) * 4;
                    const r = imageData.data[index];
                    const g = imageData.data[index + 1];
                    const b = imageData.data[index + 2];
                    const a = imageData.data[index + 3];
                    
                    // Only draw if pixel is not transparent
                    if (a > 0) {
                        pixelatedCtx.fillStyle = `rgba(${r}, ${g}, ${b}, ${a/255})`;
                        pixelatedCtx.fillRect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
                    }
                }
            }
            
            // Draw grid overlay
            drawGrid();
        }

        function drawGrid() {
            const pixelSize = 10;
            pixelatedCtx.strokeStyle = '#333';
            pixelatedCtx.lineWidth = 1;
            
            // Draw vertical lines
            for (let x = 0; x <= 60; x++) {
                pixelatedCtx.beginPath();
                pixelatedCtx.moveTo(x * pixelSize, 0);
                pixelatedCtx.lineTo(x * pixelSize, 600);
                pixelatedCtx.stroke();
            }
            
            // Draw horizontal lines
            for (let y = 0; y <= 60; y++) {
                pixelatedCtx.beginPath();
                pixelatedCtx.moveTo(0, y * pixelSize);
                pixelatedCtx.lineTo(600, y * pixelSize);
                pixelatedCtx.stroke();
            }
        }

        function downloadPattern() {
            if (!currentImageData) {
                alert('Please upload an image first!');
                return;
            }
            
            const link = document.createElement('a');
            link.download = 'beading-pattern-60x60.png';
            link.href = pixelatedCanvas.toDataURL();
            link.click();
        }

        // Load a default demonstration if no image is uploaded
        window.onload = function() {
            // You can add a default image here if needed
        };
    </script>
</body>
</html>